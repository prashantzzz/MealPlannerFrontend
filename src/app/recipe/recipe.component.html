<div class="container mx-auto p-10 px-24 pt-24">
  <!-- <h2 class="text-2xl text-gray-800 font-bold mb-4">Recipes</h2> -->

  <!-- Recipe Form for userRole === 'Admin' || userRole === 'Chef' || userRole === 'Nutritionist' -->
  <div *ngIf="userRole === 'Admin' || userRole === 'Chef' || userRole === 'Nutritionist'" class="mb-8">
    <h3 class="text-xl  text-gray-800 font-semibold mb-2">{{ editingRecipe ? 'Edit Recipe' : 'Create Recipe' }}</h3>
    <form (ngSubmit)="onSubmit()">
      <div class="mb-4">
        <label for="name" class="block text-sm font-medium">Name</label>
        <input [(ngModel)]="recipeForm.name" id="name" name="name" class="w-full border rounded p-2" required />
      </div>
      <div class="mb-4">
        <label for="category" class="block text-sm font-medium">Category</label>
        <input [(ngModel)]="recipeForm.category" id="category" name="category" class="w-full border rounded p-2" />
      </div>
      <div class="mb-4">
        <label for="ingredients" class="block text-sm font-medium">Ingredients</label>
        <textarea [(ngModel)]="recipeForm.ingredients" id="ingredients" name="ingredients"
          class="w-full border rounded p-2"></textarea>
      </div>
      <div class="mb-4">
        <label for="preparationSteps" class="block text-sm font-medium">Preparation Steps</label>
        <input [(ngModel)]="recipeForm.preparationSteps" id="preparationSteps" name="preparationSteps" type="number"
          class="w-full border rounded p-2" />
      </div>
      <div class="mb-4">
        <label for="cookingTime" class="block text-sm font-medium">Cooking Time (minutes)</label>
        <input [(ngModel)]="recipeForm.cookingTime" id="cookingTime" name="cookingTime" type="number"
          class="w-full border rounded p-2" />
      </div>
      <div class="mb-4">
        <label for="servings" class="block text-sm font-medium">Servings</label>
        <input [(ngModel)]="recipeForm.servings" id="servings" name="servings" type="number"
          class="w-full border rounded p-2" />
      </div>
      <div class="mb-4">
        <label for="nutritionalInfo" class="block text-sm font-medium">Nutritional Info</label>
        <textarea [(ngModel)]="recipeForm.nutritionalInfo" id="nutritionalInfo" name="nutritionalInfo"
          class="w-full border rounded p-2"></textarea>
      </div>
      <button type="submit" class="bg-emerald-500 text-white px-4 py-2 rounded hover:bg-emerald-700">
        {{ editingRecipe ? 'Update Recipe' : 'Create Recipe' }}
      </button>
    </form>
  </div>

  <!-- Recipe List -->
  <div *ngIf="recipes.length > 0; else noRecipes" class="text-gray-800">
    <div *ngFor="let recipe of recipes"
      class="recipe-card p-6 bg-white border border-gray-200 shadow-md rounded-lg hover:shadow-lg transition mb-6">
      <!-- Recipe Title -->
      <h2 class="font-bold text-2xl text-emerald-700 border-b border-gray-200 pb-2 mb-4 flex items-center">
        <span class="bg-emerald-100 text-emerald-700 px-2 py-1 rounded-full mr-2 text-sm">
          #{{ recipe.RecipeId }}
        </span>
        {{ recipe.name }}
      </h2>

      <!-- Recipe Details -->
      <div class="space-y-3 text-sm text-gray-600">
        <p><span class="font-semibold text-gray-800">Category:</span> {{ recipe.category }}</p>
        <p><span class="font-semibold text-gray-800">Cooking Time:</span> {{ recipe.cookingTime }} minutes</p>
        <p><span class="font-semibold text-gray-800">Preparation Steps:</span> {{ recipe.preparationSteps }}</p>
        <p><span class="font-semibold text-gray-800">Servings:</span> {{ recipe.servings }}</p>
        <p><span class="font-semibold text-gray-800">Ingredients:</span></p>
        <ul class="list-disc list-inside pl-4">
          <li *ngFor="let ingredient of recipe.ingredients.split(',')">
            {{ ingredient.trim() }}
          </li>
        </ul>
        <p><span class="font-semibold text-gray-800">Nutritional Info:</span> {{ recipe.nutritionalInfo }}</p>

        <!-- Admin/Chef/Nutritionist Actions -->
        <div class="mt-4">
          <button *ngIf="userRole === 'Admin' || userRole === 'Chef' || userRole === 'Nutritionist'"
            class="bg-blue-400 text-white px-3 py-1 rounded mr-2 hover:bg-blue-700" (click)="editRecipe(recipe)">
            Edit
          </button>
          <button *ngIf="userRole === 'Admin' || userRole === 'Chef' || userRole === 'Nutritionist'"
            class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-700" (click)="deleteRecipe(recipe.RecipeId)">
            Delete
          </button>
          <button class="bg-blue-500 text-white px-4 py-2 mt-4 rounded hover:bg-blue-700"
            (click)="showRecipeReviews(recipe.RecipeId)">
            {{ reviewVisibility[recipe.RecipeId] ? 'Hide Reviews' : 'Show Reviews' }}
          </button>
        </div>
      </div>

      <!-- Reviews Section -->
      <div *ngIf="reviewVisibility[recipe.RecipeId]" class="mt-4">
        <h4 class="text-lg font-bold mb-2">User Reviews:</h4>
        <div *ngIf="reviews.length > 0; else noReviews">
          <div *ngFor="let review of reviews" class="border border-gray-300 p-4 rounded-lg mb-2">
            <p><span class="font-semibold">Rating:</span> {{ review.rating }} / 5</p>
            <p><span class="font-semibold">Review:</span> {{ review.reviewText }}</p>
            <p class="text-gray-500 text-sm">{{ review.reviewDate | date }}</p>
          </div>
        </div>
        <ng-template #noReviews>
          <p>No reviews available for this recipe.</p>
        </ng-template>
      </div>
    </div>
  </div>

  <!-- No Recipes Template -->
  <ng-template #noRecipes>
    <div class="bg-yellow-100 text-yellow-700 p-4 rounded-lg border border-yellow-200">
      <p class="font-semibold">No recipes available. Please add some!</p>
    </div>
  </ng-template>


</div>